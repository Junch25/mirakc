#!/bin/sh

set -eu

PROGNAME=$(basename $0)
BASEDIR=$(cd $(dirname $0); pwd)
PROJDIR=$(cd $BASEDIR/..; pwd)

HEADER=$(cat <<EOF
# DO NOT EDIT THIS FILE BY HAND.
#
# This file was generated by scripts/make-github-workflows automagically.
EOF
)

cat <<EOF >$PROJDIR/.github/workflows/ci.yml
$HEADER
$(yq m $BASEDIR/github/workflows/ci.workflow.yml \
    $BASEDIR/github/workflows/linux-build.job.yml \
    $BASEDIR/github/workflows/macos-build.job.yml \
    $BASEDIR/github/workflows/arm-linux-build.job.yml \
    $BASEDIR/github/workflows/coverage.job.yml \
    $BASEDIR/github/workflows/docker.job.yml)
EOF

cat <<EOF >$PROJDIR/.github/workflows/release.yml
$HEADER
$(yq m $BASEDIR/github/workflows/release.workflow.yml \
    $BASEDIR/github/workflows/docker.job.yml)
EOF

cat <<EOF >$PROJDIR/.github/workflows/pull-request.yml
$HEADER
$(yq m $BASEDIR/github/workflows/pull-request.workflow.yml \
    $BASEDIR/github/workflows/linux-build.job.yml \
    $BASEDIR/github/workflows/macos-build.job.yml \
    $BASEDIR/github/workflows/arm-linux-build.job.yml \
    $BASEDIR/github/workflows/coverage.job.yml \
    $BASEDIR/github/workflows/auto-merge.job.yml)
EOF
